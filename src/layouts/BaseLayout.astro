---
import ThemeProvider from '@/components/theme-switcher/ThemeProvider.astro';
import { getLangFromUrl, useTranslations } from '@/i18n/utils';
import { github, linkedin } from '@/settings';

interface Props {
  title?: string;
  description?: string;
  ogImage?: string;
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const {
  title = t('meta.title'),
  description = t('meta.description'),
  ogImage = '/og-image.jpg',
} = Astro.props;
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <meta
      name="keywords"
      content="Software Engineer, Full Stack Developer, Web Developer, Desarrollador Web, Software Garatzailea, Web Garapena, Urnieta, Basque Country, Euskal Herria, País Vasco, Clojure, ClojureScript, JavaScript, TypeScript, Astro, React, Datomic, Freelance Developer, Hire Software Engineer, Web Application Development, Healthcare Software, Open Source Contributor"
    />

    <!-- Author and Copyright -->
    <meta name="author" content="Jon Ramos" />
    <meta name="copyright" content="Jon Ramos" />

    <!-- Robots and Indexing -->
    <meta
      name="robots"
      content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"
    />
    <meta name="googlebot" content="index, follow" />
    <meta name="bingbot" content="index, follow" />

    <!-- Geo-targeting for local SEO -->
    <meta name="geo.region" content="ES-PV" />
    <meta name="geo.placename" content="Urnieta, Gipuzkoa, Basque Country" />
    <meta name="geo.position" content="43.2333;-1.9167" />
    <meta name="ICBM" content="43.2333, -1.9167" />

    <!-- Mobile and PWA optimization -->
    <meta name="theme-color" content="#0d1117" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Jon Ramos" />

    <link rel="sitemap" href="/sitemap.xml" />

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="profile" />
    <meta property="og:site_name" content="Jon Ramos - Software Engineer" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={`${Astro.url.origin}${ogImage}`} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta
      property="og:image:alt"
      content="Jon Ramos - Software Engineer Portfolio"
    />
    <meta property="og:url" content={Astro.url} />
    <meta
      property="og:locale"
      content={lang === 'eu' ? 'eu_ES' : lang === 'es' ? 'es_ES' : 'en_US'}
    />
    <meta property="og:locale:alternate" content="en_US" />
    <meta property="og:locale:alternate" content="es_ES" />
    <meta property="og:locale:alternate" content="eu_ES" />

    <!-- Profile-specific OG tags -->
    <meta property="profile:first_name" content="Jon" />
    <meta property="profile:last_name" content="Ramos" />
    <meta property="profile:username" content="jramosg" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@jramosg" />
    <meta name="twitter:creator" content="@jramosg" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={`${Astro.url.origin}${ogImage}`} />
    <meta
      name="twitter:image:alt"
      content="Jon Ramos - Software Engineer Portfolio"
    />

    <!-- Canonical URL -->
    <link rel="canonical" href={Astro.url.href} />

    <!-- Hreflang for multilingual SEO -->
    <link rel="alternate" hreflang="en" href={`${Astro.url.origin}/en`} />
    <link rel="alternate" hreflang="es" href={`${Astro.url.origin}/es`} />
    <link rel="alternate" hreflang="eu" href={`${Astro.url.origin}/eu`} />
    <link
      rel="alternate"
      hreflang="x-default"
      href={`${Astro.url.origin}/en`}
    />

    <link rel="icon" type="image/ico" href="/favicon.ico" />
    <meta name="generator" content={Astro.generator} />

    <!-- Typography: JetBrains Mono for code/headings, Crimson Pro for body -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Crimson+Pro:ital,wght@0,400;0,500;0,600;1,400&display=swap"
      rel="stylesheet"
    />
    <title>{title}</title>

    <!-- WebSite Schema for Google Sitelinks -->
    <script
      type="application/ld+json"
      is:inline
      set:html={JSON.stringify({
        '@context': 'https://schema.org',
        '@type': 'WebSite',
        name: 'Jon Ramos - Software Engineer Portfolio',
        alternateName: ['Jon Ramos Portfolio', 'jonramos.dev'],
        url: Astro.url.origin,
        description: t('meta.description'),
        inLanguage: [lang, 'en', 'es', 'eu'],
        author: {
          '@type': 'Person',
          name: 'Jon Ramos',
        },
      })}
    />

    <!-- ProfilePage Schema - signals expertise to Google -->
    <script
      type="application/ld+json"
      is:inline
      set:html={JSON.stringify({
        '@context': 'https://schema.org',
        '@type': 'ProfilePage',
        dateCreated: '2024-01-01T00:00:00Z',
        dateModified: new Date().toISOString(),
        mainEntity: {
          '@type': 'Person',
          '@id': `${Astro.url.origin}/#person`,
          name: 'Jon Ramos',
          givenName: 'Jon',
          familyName: 'Ramos',
          jobTitle: t('meta.jobTitles').split(', '),
          description: t('meta.structuredDescription'),
          url: Astro.url.origin,
          image: `${Astro.url.origin}/og-image.jpg`,
          email: 'jonurnieta@gmail.com',
          address: {
            '@type': 'PostalAddress',
            addressLocality: 'Urnieta',
            addressRegion: 'Gipuzkoa',
            addressCountry: 'ES',
          },
          workLocation: {
            '@type': 'Place',
            name: 'Urnieta, Basque Country',
            address: {
              '@type': 'PostalAddress',
              addressLocality: 'Urnieta',
              addressRegion: 'Euskal Herria / Basque Country',
              addressCountry: 'ES',
            },
          },
          sameAs: [
            `https://github.com/${github}`,
            `https://linkedin.com/in/${linkedin}`,
          ],
          knowsLanguage: [
            { '@type': 'Language', name: 'Basque', alternateName: 'Euskara' },
            { '@type': 'Language', name: 'Spanish', alternateName: 'Español' },
            { '@type': 'Language', name: 'English' },
          ],
          knowsAbout: [
            'Software Engineering',
            'Full Stack Development',
            'Web Development',
            'Clojure',
            'ClojureScript',
            'JavaScript',
            'TypeScript',
            'React',
            'Astro Framework',
            'Datomic Database',
            'Functional Programming',
            'Healthcare Software',
            'Open Source Development',
          ],
          hasOccupation: {
            '@type': 'Occupation',
            name: 'Software Engineer',
            occupationLocation: {
              '@type': 'Country',
              name: 'Spain',
            },
            skills:
              'Clojure, ClojureScript, JavaScript, TypeScript, React, Astro, Datomic, Full Stack Development, Web Applications, Healthcare Software',
          },
          worksFor: {
            '@type': 'Organization',
            name: 'Ubikare',
            url: 'https://ubikare.io/',
            description: 'Healthcare technology company',
          },
          alumniOf: {
            '@type': 'EducationalOrganization',
            name: 'Software Engineering Studies',
          },
          makesOffer: [
            {
              '@type': 'Offer',
              itemOffered: {
                '@type': 'Service',
                name: 'Web Development Services',
                description:
                  'Custom web application development using modern technologies like Astro, React, and Clojure/ClojureScript',
              },
            },
            {
              '@type': 'Offer',
              itemOffered: {
                '@type': 'Service',
                name: 'Full Stack Development',
                description:
                  'End-to-end software development from frontend to backend with focus on performance and data-driven solutions',
              },
            },
            {
              '@type': 'Offer',
              itemOffered: {
                '@type': 'Service',
                name: 'Freelance Software Engineering',
                description:
                  'Professional freelance development services for businesses in Basque Country and internationally',
              },
            },
          ],
        },
      })}
    />

    <!-- BreadcrumbList for better navigation in search results -->
    <script
      type="application/ld+json"
      is:inline
      set:html={JSON.stringify({
        '@context': 'https://schema.org',
        '@type': 'BreadcrumbList',
        itemListElement: [
          {
            '@type': 'ListItem',
            position: 1,
            name: 'Home',
            item: Astro.url.origin,
          },
        ],
      })}
    />
  </head>
  <body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div class="background-texture" aria-hidden="true"></div>
    <div class="background-grid" aria-hidden="true"></div>
    <slot />
  </body>
  <ThemeProvider />
</html>

<style is:global>
  :root {
    /* Terminal Editorial Dark Theme - Default */
    --color-bg: #0d1117;
    --color-bg-elevated: #161b22;
    --color-bg-surface: #21262d;
    --color-text: #e6edf3;
    --color-text-muted: #aeb4bc;
    --color-text-subtle: #6e7681;

    /* Accent Colors - Mint/Cyan terminal feel */
    --color-primary: #7ee787;
    --color-primary-muted: rgba(126, 231, 135, 0.15);
    --color-secondary: #58a6ff;
    --color-accent: #f78166;
    --color-featured: #d2a8ff;

    /* Borders and surfaces */
    --color-border: rgba(240, 246, 252, 0.1);
    --color-border-emphasis: rgba(240, 246, 252, 0.2);
    --color-card-bg: rgba(22, 27, 34, 0.8);
    --color-bg-alpha: rgba(13, 17, 23, 0.95);

    /* Typography */
    --font-mono:
      'JetBrains Mono', ui-monospace, SFMono-Regular, 'SF Mono', Menlo,
      Consolas, monospace;
    --font-serif: 'Crimson Pro', Georgia, 'Times New Roman', serif;

    /* Layout */
    --max-width: 1200px;
    --nav-height: 72px;

    /* Animation */
    --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
    --ease-out-quint: cubic-bezier(0.22, 1, 0.36, 1);
  }

  [data-theme='light'] {
    --color-bg: #fafbfc;
    --color-bg-elevated: #ffffff;
    --color-bg-surface: #f3f4f6;
    --color-text: #1f2328;
    --color-text-muted: #57606a;
    --color-text-subtle: #8b949e;

    --color-primary: #1a7f37;
    --color-primary-muted: rgba(26, 127, 55, 0.1);
    --color-secondary: #0969da;
    --color-accent: #cf222e;
    --color-featured: #8250df;

    --color-border: rgba(31, 35, 40, 0.1);
    --color-border-emphasis: rgba(31, 35, 40, 0.2);
    --color-card-bg: rgba(255, 255, 255, 0.9);
    --color-bg-alpha: rgba(250, 251, 252, 0.95);
  }

  * {
    box-sizing: border-box;
  }

  html {
    font-family: var(--font-serif);
    background: var(--color-bg);
    color: var(--color-text);
    scroll-behavior: smooth;
    font-size: 18px;
    line-height: 1.6;
  }

  body {
    margin: 0;
    padding: 0;
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
  }

  /* Subtle grid background for terminal feel */
  .background-grid {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -2;
    background-image:
      linear-gradient(rgba(126, 231, 135, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(126, 231, 135, 0.03) 1px, transparent 1px);
    background-size: 60px 60px;
    pointer-events: none;
  }

  /* Noise texture overlay */
  .background-texture {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    opacity: 0.4;
    pointer-events: none;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
  }

  [data-theme='light'] .background-grid {
    background-image:
      linear-gradient(rgba(26, 127, 55, 0.04) 1px, transparent 1px),
      linear-gradient(90deg, rgba(26, 127, 55, 0.04) 1px, transparent 1px);
  }

  [data-theme='light'] .background-texture {
    opacity: 0.15;
  }

  a {
    color: inherit;
    text-decoration: none;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    margin: 0;
    font-family: var(--font-mono);
    font-weight: 600;
    letter-spacing: -0.02em;
    line-height: 1.2;
  }

  p {
    color: var(--color-text-muted);
    line-height: 1.7;
    margin-top: 0;
    font-family: var(--font-serif);
  }

  code,
  pre {
    font-family: var(--font-mono);
  }

  /* Utility classes */
  .container {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: 0 2rem;
  }

  .section-title {
    font-size: 2rem;
    margin-bottom: 3rem;
    color: var(--color-text);
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 1rem;
  }

  .section-title::before {
    content: '//';
    color: var(--color-primary);
    font-weight: 400;
  }

  /* Skip link for accessibility */
  .skip-link {
    position: absolute;
    top: -40px;
    left: 0;
    background: var(--color-primary);
    color: var(--color-bg);
    padding: 0.5rem 1rem;
    text-decoration: none;
    z-index: 100;
    font-family: var(--font-mono);
    font-size: 0.875rem;
  }

  .skip-link:focus {
    top: 0;
  }

  /* Responsive typography */
  @media (max-width: 768px) {
    html {
      font-size: 16px;
    }

    .container {
      padding: 0 1.25rem;
    }

    .section-title {
      font-size: 1.5rem;
      margin-bottom: 2rem;
    }
  }

  /* View transitions */
  ::view-transition-group(root) {
    animation-duration: 0.5s;
    animation-timing-function: var(--ease-out-expo);
  }

  ::view-transition-new(root) {
    animation-name: reveal-light;
    animation-fill-mode: both;
  }

  ::view-transition-old(root),
  .dark::view-transition-old(root) {
    animation: none;
    animation-fill-mode: both;
    z-index: -1;
  }

  .dark::view-transition-new(root) {
    animation-name: reveal-dark;
    animation-fill-mode: both;
  }

  @keyframes reveal-dark {
    from {
      clip-path: polygon(50% -71%, -50% 71%, -50% 71%, 50% -71%);
    }
    to {
      clip-path: polygon(50% -71%, -50% 71%, 50% 171%, 171% 50%);
    }
  }

  @keyframes reveal-light {
    from {
      clip-path: polygon(171% 50%, 50% 171%, 50% 171%, 171% 50%);
    }
    to {
      clip-path: polygon(171% 50%, 50% 171%, -50% 71%, 50% -71%);
    }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      transition: none !important;
      animation: none !important;
    }
  }

  /* Focus styles */
  button:focus-visible,
  a:focus-visible,
  input:focus-visible,
  textarea:focus-visible,
  select:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }

  button:focus:not(:focus-visible),
  a:focus:not(:focus-visible),
  input:focus:not(:focus-visible),
  textarea:focus:not(:focus-visible),
  select:focus:not(:focus-visible) {
    outline: none;
  }

  /* Selection */
  ::selection {
    background: var(--color-primary);
    color: var(--color-bg);
  }

  /* Custom scrollbar */
  ::-webkit-scrollbar {
    width: 10px;
    height: 10px;
  }

  ::-webkit-scrollbar-track {
    background: var(--color-bg);
  }

  ::-webkit-scrollbar-thumb {
    background: var(--color-border-emphasis);
    border-radius: 5px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-subtle);
  }
</style>

---
import ThemeProvider from '@/components/theme-switcher/ThemeProvider.astro';
import { getLangFromUrl, useTranslations } from '@/i18n/utils';
import { github, linkedin } from '@/settings';

interface Props {
  title?: string;
  description?: string;
  ogImage?: string;
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const {
  title = t('meta.title'),
  description = t('meta.description'),
  ogImage = '/og-image.jpg',
} = Astro.props;
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <meta
      name="keywords"
      content="Software Engineer, Full Stack Developer, Web Developer, Desarrollador Web, Software Garatzailea, Web Garapena, Urnieta, Basque Country, Euskal Herria, País Vasco, Clojure, ClojureScript, JavaScript, TypeScript, Astro, React, Datomic, Freelance Developer, Hire Software Engineer, Web Application Development, Healthcare Software, Open Source Contributor"
    />

    <!-- Author and Copyright -->
    <meta name="author" content="Jon Ramos" />
    <meta name="copyright" content="Jon Ramos" />

    <!-- Robots and Indexing -->
    <meta
      name="robots"
      content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"
    />
    <meta name="googlebot" content="index, follow" />
    <meta name="bingbot" content="index, follow" />

    <!-- Geo-targeting for local SEO -->
    <meta name="geo.region" content="ES-PV" />
    <meta name="geo.placename" content="Urnieta, Gipuzkoa, Basque Country" />
    <meta name="geo.position" content="43.2333;-1.9167" />
    <meta name="ICBM" content="43.2333, -1.9167" />

    <!-- Mobile and PWA optimization -->
    <meta name="theme-color" content="#7c3aed" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Jon Ramos" />

    <link rel="sitemap" href="/sitemap.xml" />

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="profile" />
    <meta property="og:site_name" content="Jon Ramos - Software Engineer" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={`${Astro.url.origin}${ogImage}`} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta
      property="og:image:alt"
      content="Jon Ramos - Software Engineer Portfolio"
    />
    <meta property="og:url" content={Astro.url} />
    <meta
      property="og:locale"
      content={lang === 'eu' ? 'eu_ES' : lang === 'es' ? 'es_ES' : 'en_US'}
    />
    <meta property="og:locale:alternate" content="en_US" />
    <meta property="og:locale:alternate" content="es_ES" />
    <meta property="og:locale:alternate" content="eu_ES" />

    <!-- Profile-specific OG tags -->
    <meta property="profile:first_name" content="Jon" />
    <meta property="profile:last_name" content="Ramos" />
    <meta property="profile:username" content="jramosg" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@jramosg" />
    <meta name="twitter:creator" content="@jramosg" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={`${Astro.url.origin}${ogImage}`} />
    <meta
      name="twitter:image:alt"
      content="Jon Ramos - Software Engineer Portfolio"
    />

    <!-- Canonical URL -->
    <link rel="canonical" href={Astro.url.href} />

    <!-- Hreflang for multilingual SEO -->
    <link rel="alternate" hreflang="en" href={`${Astro.url.origin}/en`} />
    <link rel="alternate" hreflang="es" href={`${Astro.url.origin}/es`} />
    <link rel="alternate" hreflang="eu" href={`${Astro.url.origin}/eu`} />
    <link
      rel="alternate"
      hreflang="x-default"
      href={`${Astro.url.origin}/en`}
    />

    <link rel="icon" type="image/ico" href="/favicon.ico" />
    <meta name="generator" content={Astro.generator} />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <title>{title}</title>

    <!-- WebSite Schema for Google Sitelinks -->
    <script
      type="application/ld+json"
      is:inline
      set:html={JSON.stringify({
        '@context': 'https://schema.org',
        '@type': 'WebSite',
        name: 'Jon Ramos - Software Engineer Portfolio',
        alternateName: ['Jon Ramos Portfolio', 'jonramos.dev'],
        url: Astro.url.origin,
        description: t('meta.description'),
        inLanguage: [lang, 'en', 'es', 'eu'],
        author: {
          '@type': 'Person',
          name: 'Jon Ramos',
        },
      })}
    />

    <!-- ProfilePage Schema - signals expertise to Google -->
    <script
      type="application/ld+json"
      is:inline
      set:html={JSON.stringify({
        '@context': 'https://schema.org',
        '@type': 'ProfilePage',
        dateCreated: '2024-01-01T00:00:00Z',
        dateModified: new Date().toISOString(),
        mainEntity: {
          '@type': 'Person',
          '@id': `${Astro.url.origin}/#person`,
          name: 'Jon Ramos',
          givenName: 'Jon',
          familyName: 'Ramos',
          jobTitle: t('meta.jobTitles').split(', '),
          description: t('meta.structuredDescription'),
          url: Astro.url.origin,
          image: `${Astro.url.origin}/og-image.jpg`,
          email: 'jonurnieta@gmail.com',
          address: {
            '@type': 'PostalAddress',
            addressLocality: 'Urnieta',
            addressRegion: 'Gipuzkoa',
            addressCountry: 'ES',
          },
          workLocation: {
            '@type': 'Place',
            name: 'Urnieta, Basque Country',
            address: {
              '@type': 'PostalAddress',
              addressLocality: 'Urnieta',
              addressRegion: 'Euskal Herria / Basque Country',
              addressCountry: 'ES',
            },
          },
          sameAs: [
            `https://github.com/${github}`,
            `https://linkedin.com/in/${linkedin}`,
          ],
          knowsLanguage: [
            { '@type': 'Language', name: 'Basque', alternateName: 'Euskara' },
            { '@type': 'Language', name: 'Spanish', alternateName: 'Español' },
            { '@type': 'Language', name: 'English' },
          ],
          knowsAbout: [
            'Software Engineering',
            'Full Stack Development',
            'Web Development',
            'Clojure',
            'ClojureScript',
            'JavaScript',
            'TypeScript',
            'React',
            'Astro Framework',
            'Datomic Database',
            'Functional Programming',
            'Healthcare Software',
            'Open Source Development',
          ],
          hasOccupation: {
            '@type': 'Occupation',
            name: 'Software Engineer',
            occupationLocation: {
              '@type': 'Country',
              name: 'Spain',
            },
            skills:
              'Clojure, ClojureScript, JavaScript, TypeScript, React, Astro, Datomic, Full Stack Development, Web Applications, Healthcare Software',
          },
          worksFor: {
            '@type': 'Organization',
            name: 'Ubikare',
            url: 'https://ubikare.io/',
            description: 'Healthcare technology company',
          },
          alumniOf: {
            '@type': 'EducationalOrganization',
            name: 'Software Engineering Studies',
          },
          makesOffer: [
            {
              '@type': 'Offer',
              itemOffered: {
                '@type': 'Service',
                name: 'Web Development Services',
                description:
                  'Custom web application development using modern technologies like Astro, React, and Clojure/ClojureScript',
              },
            },
            {
              '@type': 'Offer',
              itemOffered: {
                '@type': 'Service',
                name: 'Full Stack Development',
                description:
                  'End-to-end software development from frontend to backend with focus on performance and data-driven solutions',
              },
            },
            {
              '@type': 'Offer',
              itemOffered: {
                '@type': 'Service',
                name: 'Freelance Software Engineering',
                description:
                  'Professional freelance development services for businesses in Basque Country and internationally',
              },
            },
          ],
        },
      })}
    />

    <!-- BreadcrumbList for better navigation in search results -->
    <script
      type="application/ld+json"
      is:inline
      set:html={JSON.stringify({
        '@context': 'https://schema.org',
        '@type': 'BreadcrumbList',
        itemListElement: [
          {
            '@type': 'ListItem',
            position: 1,
            name: 'Home',
            item: Astro.url.origin,
          },
        ],
      })}
    />
  </head>
  <body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div class="background-gradient" aria-hidden="true"></div>
    <slot />
  </body>
  <ThemeProvider />
</html>

<style is:global>
  :root {
    --color-bg: #ffffff;
    --color-text: #0a0a0a;
    --color-text-muted: #52525b;
    --color-primary: #7c3aed; /* Violet */
    --color-secondary: #db2777; /* Pink */
    --color-accent: #2563eb; /* Blue */
    --color-border: rgba(0, 0, 0, 0.1);
    --color-card-bg: rgba(0, 0, 0, 0.03);
    --color-bg-alpha: rgba(255, 255, 255, 0.8);

    --font-main: 'Outfit Variable', sans-serif;

    --max-width: 1200px;
    --nav-height: 80px;

    --expo-out: linear(
      0 0%,
      0.1684 2.66%,
      0.3165 5.49%,
      0.446 8.52%,
      0.5581 11.78%,
      0.6535 15.29%,
      0.7341 19.11%,
      0.8011 23.3%,
      0.8557 27.93%,
      0.8962 32.68%,
      0.9283 38.01%,
      0.9529 44.08%,
      0.9711 51.14%,
      0.9833 59.06%,
      0.9915 68.74%,
      1 100%
    );
  }

  [data-theme='dark'] {
    --color-bg: #0a0a0a;
    --color-text: #ededed;
    --color-text-muted: #a1a1aa;
    --color-secondary: #ec4899; /* Pink */
    --color-accent: #3b82f6; /* Blue */
    --color-border: rgba(255, 255, 255, 0.1);
    --color-card-bg: rgba(255, 255, 255, 0.03);
    --color-card-bg-solid: #1a1a1a;
    --color-bg-alpha: rgba(10, 10, 10, 0.8);
  }

  html {
    font-family: var(--font-main);
    background: var(--color-bg);
    color: var(--color-text);
    scroll-behavior: smooth;
  }

  body {
    margin: 0;
    padding: 0;
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
  }

  * {
    box-sizing: border-box;
  }

  a {
    color: inherit;
    text-decoration: none;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    margin: 0;
    font-weight: 600;
  }

  p {
    color: var(--color-text-muted);
    line-height: 1.6;
    margin-top: 0;
  }

  .background-gradient {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    background:
      radial-gradient(
        circle at 15% 50%,
        rgba(139, 92, 246, 0.08),
        transparent 25%
      ),
      radial-gradient(
        circle at 85% 30%,
        rgba(59, 130, 246, 0.08),
        transparent 25%
      );
    pointer-events: none;
  }

  /* Utility classes */
  .container {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: 0 2rem;
  }

  .section-title {
    font-size: 2.5rem;
    margin-bottom: 3rem;
    background: linear-gradient(to right, #000, #52525b);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    display: inline-block;
  }

  [data-theme='dark'] .section-title {
    background: linear-gradient(to right, #fff, #52525b);
    -webkit-background-clip: text;
  }

  .skip-link {
    position: absolute;
    top: -40px;
    left: 0;
    background: var(--color-primary);
    color: white;
    padding: 0.5rem 1rem;
    text-decoration: none;
    z-index: 100;
  }

  .skip-link:focus {
    top: 0;
  }

  @media (max-width: 768px) {
    .container {
      padding: 0 1.5rem;
    }

    .section-title {
      font-size: 2rem;
    }
  }

  ::view-transition-group(root) {
    animation-duration: 0.7s;
    animation-timing-function: var(--expo-out);
  }

  ::view-transition-new(root) {
    animation-name: reveal-light;
    animation-fill-mode: both;
  }

  ::view-transition-old(root),
  .dark::view-transition-old(root) {
    animation: none;
    animation-fill-mode: both;
    z-index: -1;
  }
  .dark::view-transition-new(root) {
    animation-name: reveal-dark;
    animation-fill-mode: both;
  }

  @keyframes reveal-dark {
    from {
      clip-path: polygon(50% -71%, -50% 71%, -50% 71%, 50% -71%);
    }
    to {
      clip-path: polygon(50% -71%, -50% 71%, 50% 171%, 171% 50%);
    }
  }

  @keyframes reveal-light {
    from {
      clip-path: polygon(171% 50%, 50% 171%, 50% 171%, 171% 50%);
    }
    to {
      clip-path: polygon(171% 50%, 50% 171%, -50% 71%, 50% -71%);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      transition: none !important;
      animation: none !important;
    }
  }

  /* Accessibility: Focus styles for keyboard navigation */
  button:focus-visible,
  a:focus-visible,
  input:focus-visible,
  textarea:focus-visible,
  select:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }

  button:focus:not(:focus-visible),
  a:focus:not(:focus-visible),
  input:focus:not(:focus-visible),
  textarea:focus:not(:focus-visible),
  select:focus:not(:focus-visible) {
    outline: none;
  }
</style>
